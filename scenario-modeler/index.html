<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BASSBOSS Scenario Modeler</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        bass: { red: '#E31937', dark: '#1a1a1a', gray: '#2d2d2d' }
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        input[type="number"] { -moz-appearance: textfield; }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        .slider { -webkit-appearance: none; appearance: none; height: 8px; border-radius: 4px; background: #e5e7eb; outline: none; }
        .slider::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 20px; height: 20px; border-radius: 50%; background: #E31937; cursor: pointer; }
        .changed { background-color: #fef3c7 !important; }
        .scenario-tab { transition: all 0.2s; }
        .scenario-tab.active { background: #E31937; color: white; }
        .scenario-tab:not(.active):hover { background: #f3f4f6; }
        .view-tab { transition: all 0.2s; border-bottom: 3px solid transparent; }
        .view-tab.active { border-bottom-color: #E31937; color: #E31937; font-weight: 600; }
        .editable-cell { min-width: 50px; }
        .editable-cell:focus { outline: 2px solid #E31937; outline-offset: -2px; }
        .positive { color: #059669; }
        .negative { color: #dc2626; }
        .month-cell { min-width: 60px; }
        @media print { .no-print { display: none !important; } }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- Auth Screen -->
    <div id="auth-screen" class="min-h-screen flex items-center justify-center bg-bass-dark">
        <div class="bg-white p-8 rounded-lg shadow-xl max-w-md w-full mx-4">
            <div class="text-center mb-6">
                <h1 class="text-2xl font-bold text-bass-dark">üéØ Scenario Modeler</h1>
                <p class="text-gray-500 mt-2">BASSBOSS 2026 Projections</p>
            </div>
            <form onsubmit="authenticate(event)">
                <input type="password" id="password" 
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-bass-red"
                    placeholder="Password" autofocus>
                <button type="submit" class="w-full mt-4 bg-bass-red text-white py-3 rounded-lg font-semibold hover:bg-red-700">
                    Access Modeler
                </button>
            </form>
            <p id="auth-error" class="text-red-500 text-center mt-4 hidden">Incorrect password</p>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="hidden">
        <header class="bg-bass-dark text-white py-4 px-6 shadow-lg no-print">
            <div class="max-w-7xl mx-auto flex justify-between items-center">
                <div>
                    <h1 class="text-xl font-bold">üéØ BASSBOSS Scenario Modeler</h1>
                    <p class="text-gray-400 text-sm">2026 Revenue Projections</p>
                </div>
                <div class="flex gap-3">
                    <button onclick="toggleHelp()" class="bg-gray-600 px-4 py-2 rounded hover:bg-gray-500 text-sm">‚ùì Help</button>
                    <button onclick="exportScenarios()" class="bg-gray-600 px-4 py-2 rounded hover:bg-gray-500 text-sm">üì• Export</button>
                    <button onclick="document.getElementById('import-file').click()" class="bg-gray-600 px-4 py-2 rounded hover:bg-gray-500 text-sm">üì§ Import</button>
                    <input type="file" id="import-file" class="hidden" accept=".json" onchange="importScenarios(event)">
                    <button onclick="window.print()" class="bg-bass-gray px-4 py-2 rounded hover:bg-gray-600">üñ®Ô∏è</button>
                </div>
            </div>
        </header>

        <!-- View Tabs -->
        <div class="bg-white border-b no-print">
            <div class="max-w-7xl mx-auto px-6">
                <div class="flex gap-8">
                    <button onclick="showView('scenario')" id="view-scenario" class="view-tab py-4 px-2 active">
                        üìä Scenario Builder
                    </button>
                    <button onclick="showView('monthly')" id="view-monthly" class="view-tab py-4 px-2">
                        üìÖ Monthly Tracker
                    </button>
                </div>
            </div>
        </div>

        <!-- Scenario Tabs -->
        <div class="bg-gray-50 border-b shadow-sm no-print">
            <div class="max-w-7xl mx-auto px-6 py-3">
                <div class="flex items-center gap-2 flex-wrap">
                    <span class="text-sm text-gray-500 mr-2">Scenarios:</span>
                    <div id="scenario-tabs" class="flex gap-2 flex-wrap"></div>
                    <button onclick="createScenario()" class="scenario-tab px-3 py-1.5 rounded border-2 border-dashed border-gray-300 text-gray-500 hover:border-bass-red hover:text-bass-red text-sm">
                        + New
                    </button>
                </div>
            </div>
        </div>

        <!-- SCENARIO VIEW -->
        <div id="content-scenario">
            <main class="max-w-7xl mx-auto px-6 py-6">
                <!-- Global Parameters -->
                <div class="bg-white rounded-lg shadow p-6 mb-6">
                    <h2 class="text-lg font-semibold mb-4">üìä Global Parameters</h2>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Default MAP Discount</label>
                            <div class="flex items-center gap-2">
                                <input type="range" id="param-discount" class="slider flex-1" min="0" max="60" step="0.5" value="42.73" oninput="updateGlobalParam('discount')">
                                <input type="number" id="param-discount-val" class="w-16 px-2 py-1 border rounded text-right text-sm" value="42.73" step="0.5" onchange="updateGlobalParamFromInput('discount')">
                                <span class="text-gray-500 text-sm">%</span>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Growth Rate <span class="text-xs text-gray-400">(auto-applies)</span></label>
                            <div class="flex items-center gap-2">
                                <input type="range" id="param-growth" class="slider flex-1" min="-50" max="50" step="1" value="5" oninput="updateGrowthRate()">
                                <input type="number" id="param-growth-val" class="w-16 px-2 py-1 border rounded text-right text-sm" value="5" step="1" onchange="updateGrowthRateFromInput()">
                                <span class="text-gray-500 text-sm">%</span>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Tariff Rate</label>
                            <div class="flex items-center gap-2">
                                <input type="range" id="param-tariff" class="slider flex-1" min="0" max="50" step="1" value="19" oninput="updateGlobalParam('tariff')">
                                <input type="number" id="param-tariff-val" class="w-16 px-2 py-1 border rounded text-right text-sm" value="19" step="1" onchange="updateGlobalParamFromInput('tariff')">
                                <span class="text-gray-500 text-sm">%</span>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">3PL Fee Rate</label>
                            <div class="flex items-center gap-2">
                                <input type="range" id="param-3pl" class="slider flex-1" min="0" max="25" step="0.5" value="12.4" oninput="updateGlobalParam('3pl')">
                                <input type="number" id="param-3pl-val" class="w-16 px-2 py-1 border rounded text-right text-sm" value="12.4" step="0.5" onchange="updateGlobalParamFromInput('3pl')">
                                <span class="text-gray-500 text-sm">%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Summary Cards -->
                <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-6">
                    <div class="bg-white rounded-lg shadow p-4">
                        <div class="text-sm text-gray-500">Channel Revenue</div>
                        <div id="summary-revenue" class="text-2xl font-bold text-green-600">$0</div>
                    </div>
                    <div class="bg-white rounded-lg shadow p-4">
                        <div class="text-sm text-gray-500">Total COGS</div>
                        <div id="summary-cogs" class="text-2xl font-bold">$0</div>
                    </div>
                    <div class="bg-white rounded-lg shadow p-4">
                        <div class="text-sm text-gray-500">Tariff Cost</div>
                        <div id="summary-tariff" class="text-2xl font-bold text-red-600">$0</div>
                    </div>
                    <div class="bg-white rounded-lg shadow p-4">
                        <div class="text-sm text-gray-500">3PL Fees</div>
                        <div id="summary-3pl" class="text-2xl font-bold text-orange-600">$0</div>
                    </div>
                    <div class="bg-white rounded-lg shadow p-4">
                        <div class="text-sm text-gray-500">Gross Margin</div>
                        <div id="summary-margin" class="text-2xl font-bold">$0</div>
                        <div id="summary-margin-pct" class="text-sm text-gray-500">0%</div>
                    </div>
                </div>

                <!-- Comparison -->
                <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg shadow p-6 mb-6">
                    <h2 class="text-lg font-semibold mb-4">üìà Scenario Comparison</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="text-center">
                            <div class="text-sm text-gray-600 mb-1">Baseline (Brent)</div>
                            <div class="text-3xl font-bold text-gray-700">$5,268,136</div>
                        </div>
                        <div class="text-center">
                            <div class="text-sm text-gray-600 mb-1">This Scenario</div>
                            <div id="comparison-scenario" class="text-3xl font-bold text-bass-red">$0</div>
                            <div id="comparison-delta" class="text-sm">‚Äî</div>
                        </div>
                        <div class="text-center">
                            <div class="text-sm text-gray-600 mb-1">Net Income Impact</div>
                            <div id="comparison-net" class="text-3xl font-bold">$0</div>
                        </div>
                    </div>
                </div>

                <!-- Product Table -->
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-lg font-semibold">üì¶ Product Assumptions</h2>
                        <div class="flex gap-2 no-print">
                            <button onclick="applyGlobalDiscount()" class="text-sm bg-gray-100 px-3 py-1 rounded hover:bg-gray-200">Apply Global Discount</button>
                            <button onclick="resetProducts()" class="text-sm bg-gray-100 px-3 py-1 rounded hover:bg-gray-200">Reset</button>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm">
                            <thead>
                                <tr class="border-b bg-gray-50">
                                    <th class="text-left py-2 px-2 font-semibold">Product</th>
                                    <th class="text-right py-2 px-2 font-semibold bg-blue-50">MAP</th>
                                    <th class="text-right py-2 px-2 font-semibold bg-blue-50">Disc%</th>
                                    <th class="text-right py-2 px-2 font-semibold">Ch.$</th>
                                    <th class="text-right py-2 px-2 font-semibold bg-blue-50">COGS</th>
                                    <th class="text-right py-2 px-2 font-semibold bg-blue-50">Rate</th>
                                    <th class="text-right py-2 px-2 font-semibold">Units</th>
                                    <th class="text-right py-2 px-2 font-semibold">Revenue</th>
                                    <th class="text-right py-2 px-2 font-semibold">Margin</th>
                                </tr>
                            </thead>
                            <tbody id="product-table"></tbody>
                            <tfoot>
                                <tr class="border-t-2 bg-gray-100 font-semibold">
                                    <td class="py-2 px-2">TOTALS</td>
                                    <td colspan="5"></td>
                                    <td id="total-units" class="py-2 px-2 text-right">0</td>
                                    <td id="total-revenue" class="py-2 px-2 text-right">$0</td>
                                    <td id="total-margin" class="py-2 px-2 text-right">$0</td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </main>
        </div>

        <!-- MONTHLY TRACKER VIEW -->
        <div id="content-monthly" class="hidden">
            <main class="max-w-7xl mx-auto px-6 py-6">
                <!-- Monthly Summary Cards -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-white rounded-lg shadow p-4">
                        <div class="text-sm text-gray-500">2026 Projected (YTD)</div>
                        <div id="monthly-projected-ytd" class="text-2xl font-bold">0</div>
                    </div>
                    <div class="bg-white rounded-lg shadow p-4">
                        <div class="text-sm text-gray-500">2026 Actual (YTD)</div>
                        <div id="monthly-actual-ytd" class="text-2xl font-bold text-bass-red">0</div>
                    </div>
                    <div class="bg-white rounded-lg shadow p-4">
                        <div class="text-sm text-gray-500">Variance</div>
                        <div id="monthly-variance-ytd" class="text-2xl font-bold">0</div>
                    </div>
                    <div class="bg-white rounded-lg shadow p-4">
                        <div class="text-sm text-gray-500">% to Plan</div>
                        <div id="monthly-pct-ytd" class="text-2xl font-bold">0%</div>
                    </div>
                </div>

                <!-- Monthly Table -->
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-lg font-semibold">üìÖ Monthly Unit Sales Tracker</h2>
                        <div class="flex gap-4 text-sm">
                            <span class="flex items-center gap-1"><span class="w-3 h-3 bg-gray-200 rounded"></span> 2025 Actual</span>
                            <span class="flex items-center gap-1"><span class="w-3 h-3 bg-blue-100 rounded"></span> 2026 Projected</span>
                            <span class="flex items-center gap-1"><span class="w-3 h-3 bg-green-100 border-2 border-green-300 rounded"></span> 2026 Actual (editable)</span>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-xs">
                            <thead>
                                <tr class="border-b bg-gray-50">
                                    <th class="text-left py-2 px-2 font-semibold sticky left-0 bg-gray-50 z-10">Product</th>
                                    <th class="text-center py-2 px-1 font-semibold">Row</th>
                                    <th class="text-right py-2 px-1 font-semibold month-cell">Jan</th>
                                    <th class="text-right py-2 px-1 font-semibold month-cell">Feb</th>
                                    <th class="text-right py-2 px-1 font-semibold month-cell">Mar</th>
                                    <th class="text-right py-2 px-1 font-semibold month-cell">Apr</th>
                                    <th class="text-right py-2 px-1 font-semibold month-cell">May</th>
                                    <th class="text-right py-2 px-1 font-semibold month-cell">Jun</th>
                                    <th class="text-right py-2 px-1 font-semibold month-cell">Jul</th>
                                    <th class="text-right py-2 px-1 font-semibold month-cell">Aug</th>
                                    <th class="text-right py-2 px-1 font-semibold month-cell">Sep</th>
                                    <th class="text-right py-2 px-1 font-semibold month-cell">Oct</th>
                                    <th class="text-right py-2 px-1 font-semibold month-cell">Nov</th>
                                    <th class="text-right py-2 px-1 font-semibold month-cell">Dec</th>
                                    <th class="text-right py-2 px-2 font-semibold bg-gray-100">Total</th>
                                </tr>
                            </thead>
                            <tbody id="monthly-table"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Monthly Revenue Summary -->
                <div class="bg-white rounded-lg shadow p-6 mt-6">
                    <h2 class="text-lg font-semibold mb-4">üí∞ Monthly Revenue (2026 Actual)</h2>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm">
                            <thead>
                                <tr class="border-b bg-gray-50">
                                    <th class="text-left py-2 px-2 font-semibold">Metric</th>
                                    <th class="text-right py-2 px-2 font-semibold">Jan</th>
                                    <th class="text-right py-2 px-2 font-semibold">Feb</th>
                                    <th class="text-right py-2 px-2 font-semibold">Mar</th>
                                    <th class="text-right py-2 px-2 font-semibold">Apr</th>
                                    <th class="text-right py-2 px-2 font-semibold">May</th>
                                    <th class="text-right py-2 px-2 font-semibold">Jun</th>
                                    <th class="text-right py-2 px-2 font-semibold">Jul</th>
                                    <th class="text-right py-2 px-2 font-semibold">Aug</th>
                                    <th class="text-right py-2 px-2 font-semibold">Sep</th>
                                    <th class="text-right py-2 px-2 font-semibold">Oct</th>
                                    <th class="text-right py-2 px-2 font-semibold">Nov</th>
                                    <th class="text-right py-2 px-2 font-semibold">Dec</th>
                                    <th class="text-right py-2 px-2 font-semibold bg-gray-100">Total</th>
                                </tr>
                            </thead>
                            <tbody id="monthly-revenue-table"></tbody>
                        </table>
                    </div>
                </div>
            </main>
        </div>

        <footer class="bg-bass-dark text-gray-400 py-4 px-6 mt-8 no-print">
            <div class="max-w-7xl mx-auto text-center text-sm">
                <p>BASSBOSS Scenario Modeler ‚Ä¢ Scenarios saved in browser</p>
            </div>
        </footer>
    </div>

    <!-- Help Modal -->
    <div id="help-modal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-lg p-6 max-w-3xl max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-start mb-4">
                <h2 class="text-xl font-bold">üìñ Scenario Modeler Guide</h2>
                <button onclick="toggleHelp()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
            </div>
            
            <div class="space-y-6 text-sm">
                <section>
                    <h3 class="font-semibold text-bass-red mb-2">üéØ Overview</h3>
                    <p class="text-gray-600">Model different 2026 revenue scenarios by adjusting pricing, discounts, costs, and sales volumes. Compare against the Brent baseline ($5.27M) and track actual performance monthly.</p>
                </section>

                <section>
                    <h3 class="font-semibold text-bass-red mb-2">üìä Scenario Builder Tab</h3>
                    <table class="w-full text-xs border-collapse">
                        <tr class="border-b"><td class="py-2 font-medium w-1/3">Global Parameters</td><td class="py-2 text-gray-600">Sliders affect all products (unless overridden per-product)</td></tr>
                        <tr class="border-b"><td class="py-2 font-medium">MAP Discount</td><td class="py-2 text-gray-600">Channel buys at MAP minus this % (e.g., 43% discount = 57% of MAP)</td></tr>
                        <tr class="border-b"><td class="py-2 font-medium">Growth Rate</td><td class="py-2 text-gray-600">Auto-scales all run rates from baseline (drag slider to see impact)</td></tr>
                        <tr class="border-b"><td class="py-2 font-medium">Tariff Rate</td><td class="py-2 text-gray-600">Applied to total COGS as import tariff cost</td></tr>
                        <tr class="border-b"><td class="py-2 font-medium">3PL Fee Rate</td><td class="py-2 text-gray-600">Applied to revenue as fulfillment cost</td></tr>
                    </table>
                </section>

                <section>
                    <h3 class="font-semibold text-bass-red mb-2">üì¶ Product Table (Editable Fields)</h3>
                    <table class="w-full text-xs border-collapse">
                        <tr class="border-b"><td class="py-2 font-medium w-1/3">MAP</td><td class="py-2 text-gray-600">Minimum Advertised Price ‚Äî edit to model price changes</td></tr>
                        <tr class="border-b"><td class="py-2 font-medium">Discount %</td><td class="py-2 text-gray-600">Per-product override ‚Äî leave blank to use global discount</td></tr>
                        <tr class="border-b"><td class="py-2 font-medium">COGS</td><td class="py-2 text-gray-600">Cost of goods sold per unit ‚Äî edit to model cost changes</td></tr>
                        <tr class="border-b"><td class="py-2 font-medium">Run Rate</td><td class="py-2 text-gray-600">Expected units sold per month ‚Äî annual = rate √ó 12</td></tr>
                    </table>
                    <p class="text-gray-500 mt-2">üí° Yellow highlight = changed from default. Click "Reset" to restore baseline values.</p>
                </section>

                <section>
                    <h3 class="font-semibold text-bass-red mb-2">üìÖ Monthly Tracker Tab</h3>
                    <p class="text-gray-600 mb-2">Track actual sales against projections. For each product:</p>
                    <table class="w-full text-xs border-collapse">
                        <tr class="border-b bg-gray-50"><td class="py-2 font-medium w-1/3">2025 Row</td><td class="py-2 text-gray-600">Historical sales (read-only reference from last year)</td></tr>
                        <tr class="border-b bg-blue-50"><td class="py-2 font-medium">Proj Row</td><td class="py-2 text-gray-600">2026 projected units based on your run rate</td></tr>
                        <tr class="border-b bg-green-50"><td class="py-2 font-medium">Actual Row</td><td class="py-2 text-gray-600">Enter real sales as they come in (editable)</td></tr>
                    </table>
                    <p class="text-gray-500 mt-2">üí° Green cells = at/above plan. Red cells = below plan. Revenue auto-calculates from actuals.</p>
                </section>

                <section>
                    <h3 class="font-semibold text-bass-red mb-2">üóÇÔ∏è Managing Scenarios</h3>
                    <table class="w-full text-xs border-collapse">
                        <tr class="border-b"><td class="py-2 font-medium w-1/3">Create New</td><td class="py-2 text-gray-600">Click "+ New" to add a scenario</td></tr>
                        <tr class="border-b"><td class="py-2 font-medium">Switch</td><td class="py-2 text-gray-600">Click scenario tabs to switch between them</td></tr>
                        <tr class="border-b"><td class="py-2 font-medium">Rename</td><td class="py-2 text-gray-600">Double-click the tab name</td></tr>
                        <tr class="border-b"><td class="py-2 font-medium">Duplicate</td><td class="py-2 text-gray-600">Click üìã to copy a scenario</td></tr>
                        <tr class="border-b"><td class="py-2 font-medium">Delete</td><td class="py-2 text-gray-600">Click ‚úï (can't delete last one)</td></tr>
                        <tr class="border-b"><td class="py-2 font-medium">Export</td><td class="py-2 text-gray-600">Download all scenarios as JSON file</td></tr>
                        <tr class="border-b"><td class="py-2 font-medium">Import</td><td class="py-2 text-gray-600">Load scenarios from a JSON file</td></tr>
                    </table>
                </section>

                <section>
                    <h3 class="font-semibold text-bass-red mb-2">üíæ Data Storage</h3>
                    <p class="text-gray-600">All scenarios are saved in your browser's localStorage. They persist across page refreshes and browser restarts. Use Export to back up your work or share with others.</p>
                </section>

                <section class="bg-gray-50 p-4 rounded">
                    <h3 class="font-semibold mb-2">üî¢ Key Formulas</h3>
                    <ul class="text-xs text-gray-600 space-y-1 font-mono">
                        <li>Channel Price = MAP √ó (1 - Discount%)</li>
                        <li>Annual Units = Run Rate √ó 12</li>
                        <li>Revenue = Channel Price √ó Units</li>
                        <li>Gross Margin = Revenue - COGS - Tariffs - 3PL</li>
                        <li>Net Income = Gross Margin - OpEx ($1.75M)</li>
                    </ul>
                </section>
            </div>

            <div class="mt-6 pt-4 border-t text-center">
                <button onclick="toggleHelp()" class="bg-bass-red text-white px-6 py-2 rounded hover:bg-red-700">Got it!</button>
            </div>
        </div>
    </div>

    <!-- Rename Modal -->
    <div id="rename-modal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 w-80">
            <h3 class="font-semibold mb-4">Rename Scenario</h3>
            <input type="text" id="rename-input" class="w-full px-3 py-2 border rounded mb-4">
            <div class="flex gap-2 justify-end">
                <button onclick="closeRenameModal()" class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded">Cancel</button>
                <button onclick="confirmRename()" class="px-4 py-2 bg-bass-red text-white rounded hover:bg-red-700">Save</button>
            </div>
        </div>
    </div>

    <script>
        const MONTHS = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
        
        // Base product data with 2025 historical
        const BASE_PRODUCTS = [
            { sku: 'SSP118-MK3', map: 3995, cogs: 873.43, baseRunRate: 10, hist2025: [11,6,6,8,18,14,6,3,16,8,11,8] },
            { sku: 'VS21-MK3', map: 4995, cogs: 1167.20, baseRunRate: 9, hist2025: [7,10,16,5,15,9,2,9,12,8,12,3] },
            { sku: 'AT212-MK3', map: 4995, cogs: 1112.34, baseRunRate: 5, hist2025: [2,3,6,-1,6,11,3,5,8,9,5,4] },
            { sku: 'MAKARA-MK3', map: 7995, cogs: 2083.47, baseRunRate: 5, hist2025: [6,4,2,4,12,9,3,1,11,5,9,3] },
            { sku: 'KRAKEN-MK3', map: 17995, cogs: 3432.51, baseRunRate: 1, hist2025: [0,0,0,2,1,1,0,1,2,2,1,0] },
            { sku: 'CCM12-MK3', map: 2295, cogs: 614.26, baseRunRate: 15, hist2025: [22,1,8,1,36,12,5,6,19,11,13,4] },
            { sku: 'MFLA-MK3', map: 6995, cogs: 1947.32, baseRunRate: 3, hist2025: [3,0,6,0,12,8,3,2,6,3,6,2] },
            { sku: 'DIAMON-MK3', map: 2795, cogs: 593.28, baseRunRate: 8, hist2025: [4,2,8,3,16,8,6,3,8,4,4,2] },
            { sku: 'ZV28-MK3', map: 5995, cogs: 1752.82, baseRunRate: 6, hist2025: [7,0,7,3,15,10,7,2,19,7,9,4] },
            { sku: 'AT312-MK3', map: 5495, cogs: 1243.41, baseRunRate: 3, hist2025: [2,0,4,0,5,5,3,1,4,2,3,3] },
            { sku: 'DV12-MK3', map: 3495, cogs: 946.08, baseRunRate: 18, hist2025: [21,4,12,3,33,16,10,12,31,16,22,8] },
            { sku: 'SSP218-MK3', map: 5995, cogs: 1562.04, baseRunRate: 5, hist2025: [2,1,2,0,7,7,3,5,8,5,8,2] },
            { sku: 'DJ18S-MK3', map: 3495, cogs: 838.14, baseRunRate: 8, hist2025: [8,2,8,4,12,14,7,5,8,4,10,2] },
            { sku: 'SSP215-MK3', map: 5495, cogs: 1541.86, baseRunRate: 2, hist2025: [1,0,1,0,2,0,0,0,1,0,1,0] },
            { sku: 'KRAKATOA-MK3', map: 17995, cogs: 3724.15, baseRunRate: 1, hist2025: [0,0,0,0,0,1,0,0,1,1,0,0] },
            { sku: 'BB15-MK3', map: 2995, cogs: 734.91, baseRunRate: 15, hist2025: [12,6,11,3,29,18,13,10,25,14,22,8] },
            { sku: 'SV9-MK3', map: 1595, cogs: 549.16, baseRunRate: 25, hist2025: [23,13,17,8,42,32,22,23,56,32,49,28] },
            { sku: 'SUBLIM8-MK3', map: 7995, cogs: 1925.28, baseRunRate: 8, hist2025: [5,2,4,2,8,6,4,5,10,6,9,5] },
        ];

        const BASELINE_REVENUE = 5268136;
        const EXISTING_OPEX = 1352452;
        const NEW_OPEX_PAYROLL = 400000;
        const STORAGE_KEY = 'bassboss-scenarios-v2';

        let scenarios = {};
        let currentScenarioId = null;
        let renameTargetId = null;
        let currentView = 'scenario';

        function getDefaultScenario(name = 'Baseline') {
            return {
                name,
                globalParams: { discount: 42.73, growth: 0, tariff: 19, '3pl': 12.4 },
                products: BASE_PRODUCTS.map(p => ({
                    sku: p.sku,
                    map: p.map,
                    discount: null,
                    cogs: p.cogs,
                    runRate: p.baseRunRate,
                    actuals2026: [0,0,0,0,0,0,0,0,0,0,0,0]
                }))
            };
        }

        function authenticate(e) {
            e.preventDefault();
            if (document.getElementById('password').value === 'bassboss') {
                document.getElementById('auth-screen').classList.add('hidden');
                document.getElementById('dashboard').classList.remove('hidden');
                loadScenarios();
            } else {
                document.getElementById('auth-error').classList.remove('hidden');
            }
        }

        function showView(view) {
            currentView = view;
            document.querySelectorAll('.view-tab').forEach(t => t.classList.remove('active'));
            document.getElementById('view-' + view).classList.add('active');
            document.getElementById('content-scenario').classList.toggle('hidden', view !== 'scenario');
            document.getElementById('content-monthly').classList.toggle('hidden', view !== 'monthly');
            if (view === 'monthly') renderMonthlyTracker();
        }

        function loadScenarios() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                scenarios = JSON.parse(saved);
                // Migrate old scenarios
                Object.values(scenarios).forEach(s => {
                    s.products.forEach(p => {
                        if (!p.actuals2026) p.actuals2026 = [0,0,0,0,0,0,0,0,0,0,0,0];
                    });
                });
            }
            if (Object.keys(scenarios).length === 0) {
                const id = 'scenario-' + Date.now();
                scenarios[id] = getDefaultScenario('Baseline');
                currentScenarioId = id;
            } else {
                currentScenarioId = Object.keys(scenarios)[0];
            }
            saveScenarios();
            renderTabs();
            loadScenario(currentScenarioId);
        }

        function saveScenarios() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(scenarios));
        }

        function renderTabs() {
            const container = document.getElementById('scenario-tabs');
            container.innerHTML = Object.entries(scenarios).map(([id, s]) => `
                <div class="flex items-center">
                    <button onclick="loadScenario('${id}')" 
                        class="scenario-tab px-3 py-1.5 rounded-l border text-sm ${id === currentScenarioId ? 'active' : ''}"
                        ondblclick="startRename('${id}')">
                        ${s.name}
                    </button>
                    <button onclick="duplicateScenario('${id}')" class="px-2 py-1.5 border-t border-b text-gray-400 hover:text-gray-600 hover:bg-gray-100 text-xs" title="Duplicate">üìã</button>
                    ${Object.keys(scenarios).length > 1 ? `<button onclick="deleteScenario('${id}')" class="px-2 py-1.5 border rounded-r text-gray-400 hover:text-red-600 hover:bg-red-50 text-xs" title="Delete">‚úï</button>` : '<span class="px-2 py-1.5 border rounded-r text-gray-200 text-xs">‚úï</span>'}
                </div>
            `).join('');
        }

        function loadScenario(id) {
            currentScenarioId = id;
            const s = scenarios[id];
            Object.entries(s.globalParams).forEach(([key, val]) => {
                const slider = document.getElementById(`param-${key}`);
                const input = document.getElementById(`param-${key}-val`);
                if (slider) slider.value = val;
                if (input) input.value = val;
            });
            renderTabs();
            renderProductTable();
            calculate();
            if (currentView === 'monthly') renderMonthlyTracker();
        }

        function createScenario() {
            const id = 'scenario-' + Date.now();
            scenarios[id] = getDefaultScenario(`Scenario ${Object.keys(scenarios).length + 1}`);
            saveScenarios();
            loadScenario(id);
        }

        function duplicateScenario(id) {
            const newId = 'scenario-' + Date.now();
            scenarios[newId] = JSON.parse(JSON.stringify(scenarios[id]));
            scenarios[newId].name += ' (copy)';
            saveScenarios();
            loadScenario(newId);
        }

        function deleteScenario(id) {
            if (Object.keys(scenarios).length <= 1) return;
            if (!confirm(`Delete "${scenarios[id].name}"?`)) return;
            delete scenarios[id];
            saveScenarios();
            loadScenario(Object.keys(scenarios)[0]);
        }

        function startRename(id) {
            renameTargetId = id;
            document.getElementById('rename-input').value = scenarios[id].name;
            document.getElementById('rename-modal').classList.remove('hidden');
            document.getElementById('rename-modal').classList.add('flex');
            document.getElementById('rename-input').focus();
        }

        function closeRenameModal() {
            document.getElementById('rename-modal').classList.add('hidden');
            document.getElementById('rename-modal').classList.remove('flex');
        }

        function toggleHelp() {
            const modal = document.getElementById('help-modal');
            modal.classList.toggle('hidden');
            modal.classList.toggle('flex');
        }

        function confirmRename() {
            if (renameTargetId) {
                scenarios[renameTargetId].name = document.getElementById('rename-input').value || 'Untitled';
                saveScenarios();
                renderTabs();
            }
            closeRenameModal();
        }

        function getCurrentScenario() { return scenarios[currentScenarioId]; }

        function updateGlobalParam(param) {
            const val = parseFloat(document.getElementById(`param-${param}`).value);
            document.getElementById(`param-${param}-val`).value = val;
            getCurrentScenario().globalParams[param] = val;
            saveScenarios();
            calculate();
        }

        function updateGlobalParamFromInput(param) {
            const val = parseFloat(document.getElementById(`param-${param}-val`).value);
            document.getElementById(`param-${param}`).value = val;
            getCurrentScenario().globalParams[param] = val;
            saveScenarios();
            calculate();
        }

        function updateGrowthRate() {
            const val = parseFloat(document.getElementById('param-growth').value);
            document.getElementById('param-growth-val').value = val;
            applyGrowthToRunRates(val);
        }

        function updateGrowthRateFromInput() {
            const val = parseFloat(document.getElementById('param-growth-val').value);
            document.getElementById('param-growth').value = val;
            applyGrowthToRunRates(val);
        }

        function applyGrowthToRunRates(growthPct) {
            const scenario = getCurrentScenario();
            scenario.globalParams.growth = growthPct;
            const factor = 1 + (growthPct / 100);
            scenario.products.forEach(p => {
                const base = BASE_PRODUCTS.find(b => b.sku === p.sku);
                p.runRate = Math.max(0, Math.round(base.baseRunRate * factor));
            });
            saveScenarios();
            renderProductTable();
            calculate();
        }

        function updateProduct(sku, field, value) {
            const product = getCurrentScenario().products.find(p => p.sku === sku);
            if (product) {
                product[field] = field === 'discount' && value === '' ? null : parseFloat(value) || 0;
                saveScenarios();
                calculate();
            }
        }

        function updateActual(sku, monthIdx, value) {
            const product = getCurrentScenario().products.find(p => p.sku === sku);
            if (product) {
                product.actuals2026[monthIdx] = parseInt(value) || 0;
                saveScenarios();
                renderMonthlyTracker();
            }
        }

        function applyGlobalDiscount() {
            getCurrentScenario().products.forEach(p => { p.discount = null; });
            saveScenarios();
            renderProductTable();
            calculate();
        }

        function resetProducts() {
            const s = getCurrentScenario();
            s.products = BASE_PRODUCTS.map(p => ({
                sku: p.sku, map: p.map, discount: null, cogs: p.cogs, runRate: p.baseRunRate,
                actuals2026: s.products.find(x => x.sku === p.sku)?.actuals2026 || [0,0,0,0,0,0,0,0,0,0,0,0]
            }));
            saveScenarios();
            renderProductTable();
            calculate();
        }

        function formatCurrency(n) { return '$' + Math.round(n).toLocaleString(); }
        function formatShort(n) {
            if (Math.abs(n) >= 1e6) return '$' + (n/1e6).toFixed(1) + 'M';
            if (Math.abs(n) >= 1e3) return '$' + (n/1e3).toFixed(0) + 'K';
            return '$' + Math.round(n);
        }

        function isChanged(sku, field) {
            const p = getCurrentScenario().products.find(x => x.sku === sku);
            const b = BASE_PRODUCTS.find(x => x.sku === sku);
            if (field === 'discount') return p.discount !== null;
            return p[field] !== b[field === 'runRate' ? 'baseRunRate' : field];
        }

        function renderProductTable() {
            const s = getCurrentScenario();
            document.getElementById('product-table').innerHTML = s.products.map(p => {
                const disc = p.discount !== null ? p.discount : s.globalParams.discount;
                const chPrice = p.map * (1 - disc / 100);
                const units = p.runRate * 12;
                const rev = chPrice * units;
                const margin = (chPrice - p.cogs) * units;
                return `<tr class="border-b hover:bg-gray-50">
                    <td class="py-1 px-2 font-medium">${p.sku}</td>
                    <td class="py-1 px-2 text-right bg-blue-50"><input type="number" value="${p.map}" class="editable-cell w-16 px-1 border rounded text-right ${isChanged(p.sku,'map')?'changed':''}" onchange="updateProduct('${p.sku}','map',this.value)"></td>
                    <td class="py-1 px-2 text-right bg-blue-50"><input type="number" value="${p.discount!==null?p.discount:''}" placeholder="${s.globalParams.discount}" class="editable-cell w-12 px-1 border rounded text-right ${isChanged(p.sku,'discount')?'changed':''}" onchange="updateProduct('${p.sku}','discount',this.value)"></td>
                    <td class="py-1 px-2 text-right text-gray-600">${formatCurrency(chPrice)}</td>
                    <td class="py-1 px-2 text-right bg-blue-50"><input type="number" value="${p.cogs.toFixed(2)}" step="0.01" class="editable-cell w-16 px-1 border rounded text-right ${isChanged(p.sku,'cogs')?'changed':''}" onchange="updateProduct('${p.sku}','cogs',this.value)"></td>
                    <td class="py-1 px-2 text-right bg-blue-50"><input type="number" value="${p.runRate}" class="editable-cell w-12 px-1 border rounded text-right ${isChanged(p.sku,'runRate')?'changed':''}" onchange="updateProduct('${p.sku}','runRate',this.value)"></td>
                    <td class="py-1 px-2 text-right">${units}</td>
                    <td class="py-1 px-2 text-right">${formatCurrency(rev)}</td>
                    <td class="py-1 px-2 text-right ${margin<0?'negative':''}">${formatCurrency(margin)}</td>
                </tr>`;
            }).join('');
        }

        function calculate() {
            const s = getCurrentScenario();
            let totRev = 0, totCOGS = 0, totUnits = 0, totMargin = 0;
            s.products.forEach(p => {
                const disc = p.discount !== null ? p.discount : s.globalParams.discount;
                const chPrice = p.map * (1 - disc / 100);
                const units = p.runRate * 12;
                totRev += chPrice * units;
                totCOGS += p.cogs * units;
                totUnits += units;
                totMargin += (chPrice - p.cogs) * units;
            });
            const tariff = totCOGS * s.globalParams.tariff / 100;
            const tpl = totRev * s.globalParams['3pl'] / 100;
            const gross = totRev - totCOGS - tariff - tpl;
            const pct = totRev > 0 ? (gross / totRev * 100).toFixed(1) : 0;

            document.getElementById('total-units').textContent = totUnits.toLocaleString();
            document.getElementById('total-revenue').textContent = formatCurrency(totRev);
            document.getElementById('total-margin').textContent = formatCurrency(totMargin);
            document.getElementById('summary-revenue').textContent = formatShort(totRev);
            document.getElementById('summary-cogs').textContent = formatShort(totCOGS);
            document.getElementById('summary-tariff').textContent = formatShort(tariff);
            document.getElementById('summary-3pl').textContent = formatShort(tpl);
            document.getElementById('summary-margin').textContent = formatShort(gross);
            document.getElementById('summary-margin').className = `text-2xl font-bold ${gross >= 0 ? 'text-green-600' : 'text-red-600'}`;
            document.getElementById('summary-margin-pct').textContent = pct + '% margin';

            document.getElementById('comparison-scenario').textContent = formatShort(totRev);
            const delta = totRev - BASELINE_REVENUE;
            document.getElementById('comparison-delta').innerHTML = delta >= 0 
                ? `<span class="positive">+${formatShort(delta)} (+${(delta/BASELINE_REVENUE*100).toFixed(1)}%)</span>`
                : `<span class="negative">${formatShort(delta)} (${(delta/BASELINE_REVENUE*100).toFixed(1)}%)</span>`;
            const net = totRev - totCOGS - tariff - tpl - EXISTING_OPEX - NEW_OPEX_PAYROLL;
            document.getElementById('comparison-net').textContent = formatShort(net);
            document.getElementById('comparison-net').className = `text-3xl font-bold ${net >= 0 ? 'text-green-600' : 'text-red-600'}`;
        }

        function renderMonthlyTracker() {
            const s = getCurrentScenario();
            let html = '';
            let totProj = Array(12).fill(0), totActual = Array(12).fill(0), tot2025 = Array(12).fill(0);

            s.products.forEach(p => {
                const base = BASE_PRODUCTS.find(b => b.sku === p.sku);
                const proj = Array(12).fill(p.runRate);
                const h25 = base.hist2025;
                const a26 = p.actuals2026;

                // 2025 row
                html += `<tr class="border-b bg-gray-50"><td class="py-1 px-2 font-medium sticky left-0 bg-gray-50">${p.sku}</td><td class="py-1 px-1 text-center text-gray-400">2025</td>`;
                let sum25 = 0;
                h25.forEach((v,i) => { html += `<td class="py-1 px-1 text-right text-gray-500">${v}</td>`; sum25 += v; tot2025[i] += v; });
                html += `<td class="py-1 px-2 text-right bg-gray-100 font-medium">${sum25}</td></tr>`;

                // 2026 Projected row
                html += `<tr class="border-b bg-blue-50/50"><td class="py-1 px-2 sticky left-0 bg-blue-50/50"></td><td class="py-1 px-1 text-center text-blue-600">Proj</td>`;
                let sumProj = 0;
                proj.forEach((v,i) => { html += `<td class="py-1 px-1 text-right text-blue-600">${v}</td>`; sumProj += v; totProj[i] += v; });
                html += `<td class="py-1 px-2 text-right bg-blue-100 font-medium text-blue-700">${sumProj}</td></tr>`;

                // 2026 Actual row (editable)
                html += `<tr class="border-b"><td class="py-1 px-2 sticky left-0 bg-white"></td><td class="py-1 px-1 text-center text-green-600 font-medium">Actual</td>`;
                let sumActual = 0;
                a26.forEach((v,i) => {
                    const variance = v - proj[i];
                    const varClass = v > 0 ? (variance >= 0 ? 'bg-green-100' : 'bg-red-50') : '';
                    html += `<td class="py-1 px-1 text-right ${varClass}"><input type="number" value="${v||''}" placeholder="0" class="w-12 px-1 border border-green-300 rounded text-right text-sm" onchange="updateActual('${p.sku}',${i},this.value)"></td>`;
                    sumActual += v;
                    totActual[i] += v;
                });
                html += `<td class="py-1 px-2 text-right bg-gray-100 font-medium">${sumActual}</td></tr>`;
            });

            // Totals rows
            html += `<tr class="border-t-2 bg-gray-200 font-semibold"><td class="py-2 px-2 sticky left-0 bg-gray-200">TOTALS</td><td class="py-2 px-1 text-center">2025</td>`;
            tot2025.forEach(v => html += `<td class="py-2 px-1 text-right">${v}</td>`);
            html += `<td class="py-2 px-2 text-right bg-gray-300">${tot2025.reduce((a,b)=>a+b,0)}</td></tr>`;

            html += `<tr class="bg-blue-100 font-semibold"><td class="py-2 px-2 sticky left-0 bg-blue-100"></td><td class="py-2 px-1 text-center text-blue-700">Proj</td>`;
            totProj.forEach(v => html += `<td class="py-2 px-1 text-right text-blue-700">${v}</td>`);
            html += `<td class="py-2 px-2 text-right bg-blue-200 text-blue-800">${totProj.reduce((a,b)=>a+b,0)}</td></tr>`;

            html += `<tr class="bg-green-100 font-semibold"><td class="py-2 px-2 sticky left-0 bg-green-100"></td><td class="py-2 px-1 text-center text-green-700">Actual</td>`;
            totActual.forEach(v => html += `<td class="py-2 px-1 text-right text-green-700">${v}</td>`);
            html += `<td class="py-2 px-2 text-right bg-green-200 text-green-800">${totActual.reduce((a,b)=>a+b,0)}</td></tr>`;

            document.getElementById('monthly-table').innerHTML = html;

            // Summary cards
            const ytdProj = totProj.reduce((a,b)=>a+b,0);
            const ytdActual = totActual.reduce((a,b)=>a+b,0);
            const variance = ytdActual - ytdProj;
            const pct = ytdProj > 0 ? (ytdActual / ytdProj * 100).toFixed(0) : 0;
            document.getElementById('monthly-projected-ytd').textContent = ytdProj.toLocaleString() + ' units';
            document.getElementById('monthly-actual-ytd').textContent = ytdActual.toLocaleString() + ' units';
            document.getElementById('monthly-variance-ytd').textContent = (variance >= 0 ? '+' : '') + variance.toLocaleString();
            document.getElementById('monthly-variance-ytd').className = `text-2xl font-bold ${variance >= 0 ? 'positive' : 'negative'}`;
            document.getElementById('monthly-pct-ytd').textContent = pct + '%';
            document.getElementById('monthly-pct-ytd').className = `text-2xl font-bold ${pct >= 100 ? 'positive' : pct >= 80 ? 'text-yellow-600' : 'negative'}`;

            // Revenue table
            renderMonthlyRevenue(s, totActual);
        }

        function renderMonthlyRevenue(s, totActualUnits) {
            let revByMonth = Array(12).fill(0);
            let cogsByMonth = Array(12).fill(0);
            s.products.forEach(p => {
                const disc = p.discount !== null ? p.discount : s.globalParams.discount;
                const chPrice = p.map * (1 - disc / 100);
                p.actuals2026.forEach((units, i) => {
                    revByMonth[i] += chPrice * units;
                    cogsByMonth[i] += p.cogs * units;
                });
            });
            const marginByMonth = revByMonth.map((r, i) => r - cogsByMonth[i]);

            let html = `<tr class="border-b"><td class="py-2 px-2 font-medium">Revenue</td>`;
            revByMonth.forEach(v => html += `<td class="py-2 px-2 text-right">${formatShort(v)}</td>`);
            html += `<td class="py-2 px-2 text-right bg-gray-100 font-semibold">${formatShort(revByMonth.reduce((a,b)=>a+b,0))}</td></tr>`;

            html += `<tr class="border-b"><td class="py-2 px-2 font-medium">COGS</td>`;
            cogsByMonth.forEach(v => html += `<td class="py-2 px-2 text-right text-gray-600">${formatShort(v)}</td>`);
            html += `<td class="py-2 px-2 text-right bg-gray-100 font-semibold">${formatShort(cogsByMonth.reduce((a,b)=>a+b,0))}</td></tr>`;

            html += `<tr class="bg-gray-50 font-semibold"><td class="py-2 px-2">Gross Margin</td>`;
            marginByMonth.forEach(v => html += `<td class="py-2 px-2 text-right ${v<0?'negative':'positive'}">${formatShort(v)}</td>`);
            html += `<td class="py-2 px-2 text-right bg-gray-200">${formatShort(marginByMonth.reduce((a,b)=>a+b,0))}</td></tr>`;

            document.getElementById('monthly-revenue-table').innerHTML = html;
        }

        function exportScenarios() {
            const blob = new Blob([JSON.stringify(scenarios, null, 2)], { type: 'application/json' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `bassboss-scenarios-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
        }

        function importScenarios(e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (ev) => {
                try {
                    const imported = JSON.parse(ev.target.result);
                    scenarios = { ...scenarios, ...imported };
                    saveScenarios();
                    loadScenario(currentScenarioId);
                    alert('Imported!');
                } catch (err) { alert('Error: ' + err.message); }
            };
            reader.readAsText(file);
            e.target.value = '';
        }

        document.addEventListener('keydown', e => {
            if (e.key === 'Enter' && renameTargetId) confirmRename();
            if (e.key === 'Escape') {
                closeRenameModal();
                document.getElementById('help-modal').classList.add('hidden');
                document.getElementById('help-modal').classList.remove('flex');
            }
        });

        if (location.hash === '#dev') {
            document.getElementById('auth-screen').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
            loadScenarios();
        }
    </script>
</body>
</html>
